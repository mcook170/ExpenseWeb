<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body class="{{ theme }}">

  <!-- Main Content -->
  <div class="page-wrapper">

    <!-- ‚öôÔ∏è Settings Menu (top-right) -->
    <div class="settings-wrapper">
      <button id="settings-toggle">üåû</button>
      <div id="settings-dropdown" class="dropdown">
        <form method="post" action="{{ url_for('delete_account') }}" onsubmit="return confirm('Delete your account? This cannot be undone.');" style="display:inline">
          <button type="submit" class="link-button">üèúÔ∏è Delete Account</button>
        </form>
      </div>
    </div>

    <main class="main-content">
      <div class="form">
        <h2>Hello, {{ username }}!</h2>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-message">
              {% for message in messages %}
                <p>{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Form -->
        <form method="POST">
          <div class="form-group">
            <label for="description">Description</label>
            <input type="text" name="description" id="description" class="form-input" required>
          </div>

          <div class="form-group">
            <label for="expense_type">Type</label>
            <select name="expense_type" id="expense_type" class="form-input" required>
              <option value="Food/Drink">Food/Drink</option>
              <option value="Health">Health</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Shopping">Shopping</option>
              <option value="Deposit">Deposit</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label for="amount">Amount</label>
            <input type="number" name="amount" id="amount" class="form-input" step="0.01" required>
          </div>

          <div class="form-group">
            <label for="note">Note</label>
            <input type="text" name="note" id="note" class="form-input">
          </div>

          <div class="form-buttons">
            <button type="submit" class="form-button">Add Expense</button>
            <a href="/logout" class="logout-link">Logout</a>
          </div>
          
        </form>

        <script>
          (function(){
            const wrapper = document.querySelector('.settings-wrapper');
            const toggle = document.getElementById('settings-toggle');
            if(!wrapper || !toggle) return;
            const dropdown = wrapper.querySelector('.dropdown');

            // Toggle open class on click
            toggle.addEventListener('click', function(e){
              e.stopPropagation();
              wrapper.classList.toggle('open');
              // focus first focusable element inside dropdown for keyboard users
              if(wrapper.classList.contains('open') && dropdown){
                const focusable = dropdown.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if(focusable) focusable.focus();
              }
            });

            // Close when clicking outside
            document.addEventListener('click', function(e){
              if(!wrapper.classList.contains('open')) return;
              if(!wrapper.contains(e.target)) wrapper.classList.remove('open');
            });
          })();
        </script>

</html>